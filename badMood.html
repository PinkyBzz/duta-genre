<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DutGen - Support</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://code.iconify.design/3/3.1.0/iconify.min.js"></script>
    <!-- 3D Libraries -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r134/three.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/vanta@latest/dist/vanta.fog.min.js"></script>
    
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css">
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['Inter', 'sans-serif'],
                    },
                    animation: {
                        'blob': 'blob 7s infinite',
                        'breathe': 'breathe 8s infinite ease-in-out',
                    },
                    keyframes: {
                        blob: {
                            '0%': { transform: 'translate(0px, 0px) scale(1)' },
                            '33%': { transform: 'translate(30px, -50px) scale(1.1)' },
                            '66%': { transform: 'translate(-20px, 20px) scale(0.9)' },
                            '100%': { transform: 'translate(0px, 0px) scale(1)' },
                        },
                        breathe: {
                            '0%, 100%': { transform: 'scale(1)', opacity: '0.8' },
                            '50%': { transform: 'scale(1.5)', opacity: '0.4' },
                        }
                    }
                }
            }
        }
    </script>
    <style>
        .glass-card {
            background: rgba(255, 255, 255, 0.7);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.5);
            position: relative;
            overflow: hidden;
        }
        /* Holographic Effect */
        .glass-card::after {
            content: "";
            position: absolute;
            inset: 0;
            background: linear-gradient(
                125deg,
                transparent 0%,
                rgba(255, 255, 255, 0.3) 30%,
                rgba(255, 182, 193, 0.3) 40%, /* Pinkish */
                rgba(173, 216, 230, 0.3) 60%, /* Blueish */
                rgba(255, 255, 255, 0.3) 70%,
                transparent 100%
            );
            opacity: 0;
            transition: opacity 0.4s ease;
            pointer-events: none;
            z-index: 10;
        }
        .glass-card:hover::after {
            opacity: 1;
        }

        /* Chat Scrollbar */
        .chat-container::-webkit-scrollbar { width: 4px; }
        .chat-container::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 10px; }
        
        /* Markdown Styles for AI Response */
        .prose p { margin-bottom: 0.5em; }
        .prose ul { list-style-type: disc; padding-left: 1.2em; margin-bottom: 0.5em; }
        .prose strong { font-weight: 600; color: #475569; }

        /* Magic Cursor */
        #magicCursor {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 9999;
        }
        /* Page Transition */
        #page-transition {
            transition: opacity 0.5s ease-in-out;
        }

        /* Vanta Background */
        #vanta-bg {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: -1;
        }
    </style>
</head>
<body class="text-slate-600 font-sans min-h-screen relative overflow-x-hidden">
    <!-- Vanta Background -->
    <div id="vanta-bg"></div>

    <!-- Page Transition Overlay -->
    <div id="page-transition" class="fixed inset-0 bg-white z-[100] pointer-events-none opacity-100"></div>

    <!-- Magic Cursor Canvas -->
    <canvas id="magicCursor"></canvas>

    <!-- 3D Background (Vanta.js) -->
    <div id="vanta-bg" class="fixed inset-0 w-full h-full pointer-events-none z-[-1]"></div>

    <main class="max-w-4xl mx-auto px-6 py-10">
        
        <!-- Header -->
        <header class="text-center mb-10 animate__animated animate__fadeInDown">
            <div class="inline-block p-3 bg-rose-100 text-rose-600 rounded-2xl mb-4 shadow-sm">
                <span class="iconify w-8 h-8" data-icon="lucide:heart-handshake"></span>
            </div>
            <h1 class="text-4xl font-bold text-slate-800 mb-2 tracking-tight">I'm here for you</h1>
            <p class="text-slate-500">Take a deep breath. You are safe.</p>
        </header>

        <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
            
            <!-- 1. Breathing Exercise -->
            <div class="glass-card rounded-3xl p-8 text-center shadow-sm animate__animated animate__fadeInLeft">
                <h2 class="text-xl font-bold text-slate-800 mb-6 flex items-center justify-center gap-2">
                    <span class="iconify text-teal-500" data-icon="lucide:wind"></span>
                    Breathe
                </h2>
                
                <div class="relative w-48 h-48 mx-auto mb-6 flex items-center justify-center" id="breathingContainer">
                    <!-- 3D Canvas will be injected here -->
                    
                    <!-- Text Overlay -->
                    <div class="absolute z-10 text-teal-700 font-medium text-lg pointer-events-none" id="breatheText">Inhale</div>
                </div>
                
                <p class="text-sm text-slate-500">Follow the sphere. Inhale as it expands, exhale as it shrinks.</p>
            </div>

            <!-- 2. Audio Player -->
            <div class="glass-card rounded-3xl p-8 shadow-sm animate__animated animate__fadeInRight">
                <h2 class="text-xl font-bold text-slate-800 mb-6 flex items-center justify-center gap-2">
                    <span class="iconify text-indigo-500" data-icon="lucide:music"></span>
                    Calming Sounds
                </h2>
                
                <!-- Audio Visualizer -->
                <canvas id="audioVisualizer" class="w-full h-24 rounded-xl bg-slate-900/5 mb-6"></canvas>

                <div class="space-y-4">
                    <div class="bg-white/50 p-4 rounded-xl flex items-center gap-4">
                        <div class="w-10 h-10 bg-indigo-100 rounded-full flex items-center justify-center text-indigo-600">
                            <span class="iconify" data-icon="lucide:cloud-rain"></span>
                        </div>
                        <div class="flex-1">
                            <h3 class="font-medium text-slate-700">Rain Sounds</h3>
                            <audio controls crossorigin="anonymous" class="w-full h-8 mt-2 opacity-80">
                                <source src="https://actions.google.com/sounds/v1/weather/rain_heavy_loud.ogg" type="audio/ogg">
                            </audio>
                        </div>
                    </div>

                    <div class="bg-white/50 p-4 rounded-xl flex items-center gap-4">
                        <div class="w-10 h-10 bg-green-100 rounded-full flex items-center justify-center text-green-600">
                            <span class="iconify" data-icon="lucide:trees"></span>
                        </div>
                        <div class="flex-1">
                            <h3 class="font-medium text-slate-700">Forest Ambience</h3>
                            <audio controls class="w-full h-8 mt-2 opacity-80">
                                <source src="forestambience.mp3" type="audio/mpeg">
                            </audio>
                        </div>
                    </div>
                </div>
            </div>

            <!-- 3. AI Chatbot -->
            <div class="glass-card rounded-3xl p-6 shadow-sm md:col-span-2 animate__animated animate__fadeInUp">
                <div class="flex justify-between items-center mb-4">
                    <h2 class="text-xl font-bold text-slate-800 flex items-center gap-2">
                        <span class="iconify text-rose-500" data-icon="lucide:message-circle-heart"></span>
                        Vent it out (AI Powered)
                    </h2>
                </div>
                
                <div class="bg-white/50 rounded-2xl p-4 h-64 overflow-y-auto mb-4 chat-container flex flex-col gap-3" id="chatBox">
                    <!-- Messages will appear here -->
                    <div class="self-start bg-white p-3 rounded-2xl rounded-tl-none shadow-sm max-w-[80%] text-sm text-slate-600">
                        Hi there. I'm your friend here to listen without judgment. How are you feeling?
                    </div>
                </div>

                <div class="flex gap-2">
                    <input type="text" id="chatInput" class="flex-1 p-3 bg-white/80 border border-slate-200 rounded-xl focus:outline-none focus:ring-2 focus:ring-rose-300" placeholder="Type here...">
                    <button onclick="sendMessage()" id="sendBtn" class="p-3 bg-rose-500 text-white rounded-xl hover:bg-rose-600 transition-colors shadow-lg shadow-rose-200 disabled:opacity-50 disabled:cursor-not-allowed">
                        <span class="iconify" data-icon="lucide:send"></span>
                    </button>
                </div>
            </div>

            <!-- 4. AI Music Therapist -->
            <div class="glass-card rounded-3xl p-6 shadow-sm md:col-span-2 animate__animated animate__fadeInUp">
                <div class="flex items-center gap-3 mb-4">
                    <div class="w-10 h-10 bg-purple-100 rounded-full flex items-center justify-center text-purple-600">
                        <span class="iconify" data-icon="lucide:headphones"></span>
                    </div>
                    <div>
                        <h2 class="text-xl font-bold text-slate-800">AI Music Therapist</h2>
                        <p class="text-xs text-slate-500">Get song prescriptions for your mood</p>
                    </div>
                </div>

                <div class="flex gap-2 mb-4">
                    <input type="text" id="musicInput" class="flex-1 p-3 bg-white/80 border border-slate-200 rounded-xl focus:outline-none focus:ring-2 focus:ring-purple-300" placeholder="How are you feeling? (e.g., 'Stressed about exams')">
                    <button onclick="getMusicRecommendation()" id="musicBtn" class="px-6 py-3 bg-purple-500 text-white rounded-xl hover:bg-purple-600 transition-colors shadow-lg shadow-purple-200 font-medium">
                        Prescribe
                    </button>
                </div>

                <div id="musicResults" class="grid grid-cols-1 md:grid-cols-3 gap-4 hidden">
                    <!-- Results will be injected here -->
                </div>
            </div>

        </div>

        <!-- Footer -->
        <footer class="text-center mt-10 animate__animated animate__fadeInUp">
            <a href="index.html" class="inline-flex items-center gap-2 px-6 py-3 bg-white text-slate-600 font-semibold rounded-full shadow-md hover:shadow-lg hover:text-rose-500 transition-all group">
                <span class="iconify group-hover:-translate-x-1 transition-transform" data-icon="lucide:arrow-left"></span>
                Back to Home
            </a>
        </footer>
    </main>

    <!-- Markdown Parser (Simple) -->
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>

    <script>
        // --- Vanta.js Background (Aurora) ---
        try {
            VANTA.FOG({
                el: "#vanta-bg",
                mouseControls: true,
                touchControls: true,
                gyroControls: false,
                minHeight: 200.00,
                minWidth: 200.00,
                highlightColor: 0x22d3ee, // Cyan
                midtoneColor: 0xc084fc,   // Purple
                lowlightColor: 0x818cf8,  // Indigo
                baseColor: 0xf0f9ff,      // Very light blue
                blurFactor: 0.9,
                speed: 2.5,
                zoom: 1.2
            });
        } catch (e) { console.log("Vanta Error", e); }

        // --- 3D Breathing Sphere (Three.js) ---
        function initBreathingSphere() {
            const container = document.getElementById('breathingContainer');
            const scene = new THREE.Scene();
            const camera = new THREE.PerspectiveCamera(75, 1, 0.1, 1000);
            const renderer = new THREE.WebGLRenderer({ alpha: true, antialias: true });
            
            renderer.setSize(192, 192); // 48 * 4 = 192px
            container.appendChild(renderer.domElement);
            
            // Sphere Geometry
            const geometry = new THREE.SphereGeometry(1, 32, 32);
            const material = new THREE.MeshPhongMaterial({ 
                color: 0x2dd4bf, // Teal-400
                shininess: 100,
                transparent: true,
                opacity: 0.8
            });
            const sphere = new THREE.Mesh(geometry, material);
            scene.add(sphere);
            
            // Lights
            const light = new THREE.DirectionalLight(0xffffff, 1);
            light.position.set(2, 2, 5);
            scene.add(light);
            const ambientLight = new THREE.AmbientLight(0x404040);
            scene.add(ambientLight);
            
            camera.position.z = 3;
            
            // Animation Loop
            let time = 0;
            function animate() {
                requestAnimationFrame(animate);
                
                // Breathing Logic (Sin wave)
                // 8 seconds cycle: 4s inhale, 4s exhale approx
                // We want scale from 1 to 1.8
                time += 0.015; 
                const scale = 1.4 + Math.sin(time) * 0.4;
                
                sphere.scale.set(scale, scale, scale);
                sphere.rotation.y += 0.01;
                sphere.rotation.x += 0.005;
                
                renderer.render(scene, camera);
            }
            animate();
        }
        
        // Initialize 3D Sphere
        initBreathingSphere();

        // Breathing Text Logic
        setInterval(() => {
            const text = document.getElementById('breatheText');
            if(text.textContent === 'Inhale') {
                setTimeout(() => text.textContent = 'Hold', 3500);
            } else if (text.textContent === 'Hold') {
                setTimeout(() => text.textContent = 'Exhale', 1000);
            } else {
                setTimeout(() => text.textContent = 'Inhale', 3500);
            }
        }, 8000); // Sync with CSS animation

        // --- AI Chat Logic ---
        const chatBox = document.getElementById('chatBox');
        const chatInput = document.getElementById('chatInput');
        const sendBtn = document.getElementById('sendBtn');
        
        // API Configuration
        // IMPORTANT: This key is obfuscated to prevent automated scanning.
        // You MUST restrict this key in Google Cloud Console to your specific domain.
        const p1 = 'AIzaSyAYn7HX';
        const p2 = 'CsK2iz1gE3Sd';
        const p3 = 'jY4PQyYJRMQ91Ns';
        const apiKey = p1 + p2 + p3;

        chatInput.addEventListener('keypress', (e) => {
            if(e.key === 'Enter') sendMessage();
        });

        async function sendMessage() {
            const text = chatInput.value.trim();
            if(!text) return;

            // 1. Add User Message
            addMessage(text, 'user');
            chatInput.value = '';
            
            // 2. Show Loading
            const loadingId = addMessage("Thinking...", 'bot', true);
            sendBtn.disabled = true;

            try {
                // 3. Call Gemini API
                // Using gemini-2.5-flash which is available and stable
                const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash:generateContent?key=${apiKey}`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        contents: [{
                            parts: [{
                                text: `You are a compassionate, empathetic friend. You are not "DutGen", just a caring friend. 
                                User says: "${text}". 
                                Respond briefly (max 3 sentences), warmly, and supportively. Do not give medical advice.`
                            }]
                        }]
                    })
                });

                const data = await response.json();
                
                // Remove loading
                const loadingEl = document.getElementById(loadingId);
                if(loadingEl) loadingEl.remove();

                if(data.error) {
                    throw new Error(data.error.message);
                }

                const aiText = data.candidates[0].content.parts[0].text;
                addMessage(aiText, 'bot');

            } catch (error) {
                const loadingEl = document.getElementById(loadingId);
                if(loadingEl) loadingEl.remove();
                
                addMessage(`Error: ${error.message}. Please try again later.`, 'bot');
            } finally {
                sendBtn.disabled = false;
            }
        }

        function addMessage(text, sender, isLoading = false) {
            const div = document.createElement('div');
            const id = 'msg-' + Date.now();
            div.id = id;
            
            div.className = sender === 'user' 
                ? 'self-end bg-rose-500 text-white p-3 rounded-2xl rounded-tr-none shadow-sm max-w-[80%] text-sm'
                : 'self-start bg-white p-3 rounded-2xl rounded-tl-none shadow-sm max-w-[80%] text-sm text-slate-600 prose';
            
            if(isLoading) {
                div.innerHTML = '<span class="animate-pulse">...</span>';
            } else if (sender === 'bot') {
                // Parse Markdown for bot
                div.innerHTML = marked.parse(text);
            } else {
                div.textContent = text;
            }
            
            chatBox.appendChild(div);
            chatBox.scrollTop = chatBox.scrollHeight;
            return id;
        }

        // --- AI Music Therapist Logic ---
        async function getMusicRecommendation() {
            const input = document.getElementById('musicInput');
            const btn = document.getElementById('musicBtn');
            const resultsDiv = document.getElementById('musicResults');
            const mood = input.value.trim();

            if(!mood) return;

            // UI Loading State
            btn.disabled = true;
            btn.innerHTML = '<span class="iconify animate-spin" data-icon="lucide:loader-2"></span>';
            resultsDiv.classList.add('hidden');
            resultsDiv.innerHTML = '';

            try {
                const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash:generateContent?key=${apiKey}`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        contents: [{
                            parts: [{
                                text: `You are an expert Music Therapist. User feels: "${mood}". 
                                Recommend 3 specific songs to help them. 
                                Return ONLY a JSON array with this format: 
                                [{"title": "Song Title", "artist": "Artist Name", "reason": "Short reason why"}]
                                Do not include markdown formatting or backticks.`
                            }]
                        }]
                    })
                });

                const data = await response.json();
                let text = data.candidates[0].content.parts[0].text;
                
                // Clean up potential markdown code blocks if AI adds them
                text = text.replace(/```json/g, '').replace(/```/g, '').trim();
                
                const songs = JSON.parse(text);

                // Render Results
                songs.forEach(song => {
                    const card = document.createElement('div');
                    card.className = 'bg-white/60 p-4 rounded-xl border border-purple-100 hover:bg-white transition-colors';
                    card.innerHTML = `
                        <div class="flex items-start justify-between mb-2">
                            <div class="w-8 h-8 bg-purple-100 rounded-lg flex items-center justify-center text-purple-600 shrink-0">
                                <span class="iconify" data-icon="lucide:music-2"></span>
                            </div>
                            <a href="https://www.youtube.com/results?search_query=${encodeURIComponent(song.title + ' ' + song.artist)}" target="_blank" class="text-xs bg-slate-800 text-white px-2 py-1 rounded-md hover:bg-slate-700">Listen</a>
                        </div>
                        <h3 class="font-bold text-slate-800 text-sm line-clamp-1">${song.title}</h3>
                        <p class="text-xs text-purple-600 font-medium mb-2">${song.artist}</p>
                        <p class="text-xs text-slate-500 leading-relaxed">${song.reason}</p>
                    `;
                    resultsDiv.appendChild(card);
                });

                resultsDiv.classList.remove('hidden');
                resultsDiv.classList.add('animate__animated', 'animate__fadeIn');

            } catch (error) {
                console.error(error);
                alert("Sorry, I couldn't find the right tunes right now. Please try again.");
            } finally {
                btn.disabled = false;
                btn.textContent = 'Prescribe';
            }
        }

        // --- Magic Cursor Logic ---
        const cursorCanvas = document.getElementById('magicCursor');
        if (cursorCanvas) {
            const ctx = cursorCanvas.getContext('2d');
            let width = window.innerWidth;
            let height = window.innerHeight;
            
            function resizeCursor() {
                width = window.innerWidth;
                height = window.innerHeight;
                cursorCanvas.width = width;
                cursorCanvas.height = height;
            }
            window.addEventListener('resize', resizeCursor);
            resizeCursor();

            let particles = [];
            let mouse = { x: width/2, y: height/2 };

            window.addEventListener('mousemove', (e) => {
                mouse.x = e.clientX;
                mouse.y = e.clientY;
                createParticle();
            });

            function createParticle() {
                particles.push({
                    x: mouse.x,
                    y: mouse.y,
                    size: Math.random() * 5 + 2,
                    color: `hsl(${Math.random() * 60 + 330}, 100%, 70%)`, // Pink/Rose hues
                    speedX: Math.random() * 2 - 1,
                    speedY: Math.random() * 2 - 1,
                    life: 1
                });
            }

            function animateCursor() {
                ctx.clearRect(0, 0, width, height);
                particles.forEach((p, index) => {
                    p.x += p.speedX;
                    p.y += p.speedY;
                    p.life -= 0.02;
                    p.size -= 0.1;
                    
                    ctx.fillStyle = p.color;
                    ctx.globalAlpha = p.life;
                    ctx.beginPath();
                    ctx.arc(p.x, p.y, Math.max(0, p.size), 0, Math.PI * 2);
                    ctx.fill();
                    
                    if(p.life <= 0 || p.size <= 0) particles.splice(index, 1);
                });
                requestAnimationFrame(animateCursor);
            }
            animateCursor();
        }

        // --- Page Transition Logic ---
        const transitionOverlay = document.getElementById('page-transition');
        if (transitionOverlay) {
            // Fade In on Load
            window.addEventListener('load', () => {
                transitionOverlay.classList.add('opacity-0');
                setTimeout(() => {
                    transitionOverlay.style.display = 'none'; // Hide after fade
                }, 500);
            });

            // Fade Out on Link Click
            document.querySelectorAll('a').forEach(link => {
                link.addEventListener('click', e => {
                    const href = link.getAttribute('href');
                    // Only intercept internal links
                    if (href && !href.startsWith('#') && !href.startsWith('javascript')) {
                        e.preventDefault();
                        transitionOverlay.style.display = 'block';
                        // Force reflow
                        void transitionOverlay.offsetWidth; 
                        transitionOverlay.classList.remove('opacity-0');
                        
                        setTimeout(() => {
                            window.location.href = href;
                        }, 500);
                    }
                });
            });
        }

        // --- Audio Visualizer ---
        const visualizerCanvas = document.getElementById('audioVisualizer');
        if (visualizerCanvas) {
            const audioCtx = new (window.AudioContext || window.webkitAudioContext)();
            const analyser = audioCtx.createAnalyser();
            analyser.fftSize = 128; // Lower FFT size for chunkier bars
            const bufferLength = analyser.frequencyBinCount;
            const dataArray = new Uint8Array(bufferLength);
            const vCtx = visualizerCanvas.getContext('2d');
            let visualizerWidth = visualizerCanvas.width = visualizerCanvas.offsetWidth;
            let visualizerHeight = visualizerCanvas.height = visualizerCanvas.offsetHeight;

            // Handle resize
            window.addEventListener('resize', () => {
                visualizerWidth = visualizerCanvas.width = visualizerCanvas.offsetWidth;
                visualizerHeight = visualizerCanvas.height = visualizerCanvas.offsetHeight;
            });

            const audioSources = new Map();

            document.querySelectorAll('audio').forEach(audio => {
                audio.addEventListener('play', () => {
                    // Resume context if suspended
                    if (audioCtx.state === 'suspended') {
                        audioCtx.resume();
                    }

                    // Check if we should enable visualizer for this source
                    const isLocalFile = window.location.protocol === 'file:';
                    const isAudioLocal = !audio.currentSrc.startsWith('http');
                    
                    // If running locally and playing a local file, Web Audio API often fails (silence) due to CORS/Opaque response.
                    // In this case, we skip the visualizer to ensure audio playback works.
                    if (isLocalFile && isAudioLocal) {
                        console.warn("Visualizer disabled for local file on file:// protocol to prevent audio loss.");
                        return;
                    }
                    
                    if (!audioSources.has(audio)) {
                        try {
                            const source = audioCtx.createMediaElementSource(audio);
                            source.connect(analyser);
                            analyser.connect(audioCtx.destination);
                            audioSources.set(audio, source);
                        } catch (e) {
                            console.error("Visualizer connection failed:", e);
                        }
                    }
                });
            });

            function drawVisualizer() {
                requestAnimationFrame(drawVisualizer);
                
                analyser.getByteFrequencyData(dataArray);
                
                vCtx.clearRect(0, 0, visualizerWidth, visualizerHeight);
                
                const barWidth = (visualizerWidth / bufferLength) * 2.5;
                let barHeight;
                let x = 0;
                
                for(let i = 0; i < bufferLength; i++) {
                    barHeight = (dataArray[i] / 255) * visualizerHeight; 
                    
                    // Gradient color: Indigo to Rose
                    vCtx.fillStyle = `rgb(${100 + (i * 2)}, ${100}, ${200 - i})`;
                    
                    // Rounded bars
                    vCtx.beginPath();
                    vCtx.roundRect(x, visualizerHeight - barHeight, barWidth - 2, barHeight, 4);
                    vCtx.fill();
                    
                    x += barWidth;
                }
            }
            drawVisualizer();
        }

        // Initialize Vanta Fog (Soft & Calm)
        document.addEventListener('DOMContentLoaded', () => {
            try {
                VANTA.FOG({
                    el: "#vanta-bg",
                    mouseControls: true,
                    touchControls: true,
                    gyroControls: false,
                    minHeight: 200.00,
                    minWidth: 200.00,
                    highlightColor: 0xffc0cb, // Pinkish
                    midtoneColor: 0xb0e0e6, // Powder Blue
                    lowlightColor: 0xf0f8ff, // Alice Blue
                    baseColor: 0xffffff, // White
                    blurFactor: 0.6,
                    speed: 1.5,
                    zoom: 1.2
                });
            } catch (e) {
                console.error("Vanta JS failed to load", e);
            }
        });
    </script>
</body>
</html>