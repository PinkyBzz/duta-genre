<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>DutGen - Daily Tracker</title>
    
    <!-- PWA Manifest -->
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#f0f4f8">
    <link rel="apple-touch-icon" href="icon-192.png">

    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://code.iconify.design/3/3.1.0/iconify.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css">
    
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['Inter', 'sans-serif'],
                    },
                    animation: {
                        'blob': 'blob 7s infinite',
                    },
                    keyframes: {
                        blob: {
                            '0%': { transform: 'translate(0px, 0px) scale(1)' },
                            '33%': { transform: 'translate(30px, -50px) scale(1.1)' },
                            '66%': { transform: 'translate(-20px, 20px) scale(0.9)' },
                            '100%': { transform: 'translate(0px, 0px) scale(1)' },
                        }
                    }
                }
            }
        }
    </script>
    <style>
        .glass-card {
            background: rgba(255, 255, 255, 0.7);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.5);
        }
        .modal-overlay {
            background: rgba(0, 0, 0, 0.3);
            backdrop-filter: blur(5px);
        }
        /* Hide scrollbar for clean UI */
        ::-webkit-scrollbar {
            width: 6px;
        }
        ::-webkit-scrollbar-track {
            background: transparent;
        }
        ::-webkit-scrollbar-thumb {
            background: #cbd5e1;
            border-radius: 10px;
        }
    </style>
</head>
<body class="bg-[#f0f4f8] text-slate-600 font-sans min-h-screen relative overflow-x-hidden selection:bg-rose-200 selection:text-rose-900">

    <!-- Background Blobs -->
    <div class="fixed inset-0 w-full h-full pointer-events-none z-[-1] overflow-hidden">
        <div class="absolute top-0 left-1/4 w-96 h-96 bg-rose-300 rounded-full mix-blend-multiply filter blur-3xl opacity-30 animate-blob"></div>
        <div class="absolute top-0 right-1/4 w-96 h-96 bg-cyan-300 rounded-full mix-blend-multiply filter blur-3xl opacity-30 animate-blob animation-delay-2000"></div>
        <div class="absolute -bottom-32 left-1/3 w-96 h-96 bg-purple-300 rounded-full mix-blend-multiply filter blur-3xl opacity-30 animate-blob animation-delay-4000"></div>
    </div>

    <!-- Main Content -->
    <main class="max-w-5xl mx-auto px-6 py-10">
        
        <!-- Header -->
        <header class="flex justify-between items-center mb-10 animate__animated animate__fadeInDown">
            <div>
                <h1 class="text-3xl font-bold text-slate-800 tracking-tight">Hello, <span id="userGreeting">Friend</span>!</h1>
                <p class="text-slate-500">How is your heart doing today?</p>
            </div>
            <button onclick="resetDailyMood()" class="p-2 text-slate-400 hover:text-rose-500 transition-colors" title="Reset Daily Mood">
                <span class="iconify w-6 h-6" data-icon="lucide:refresh-cw"></span>
            </button>
        </header>

        <!-- Mood Chart Section -->
        <section class="mb-10 animate__animated animate__fadeInUp" style="animation-delay: 0.1s">
            <div class="glass-card rounded-3xl p-6 shadow-sm">
                <div class="flex items-center justify-between mb-4">
                    <h2 class="text-lg font-semibold text-slate-800 flex items-center gap-2">
                        <span class="iconify text-violet-500" data-icon="lucide:bar-chart-2"></span>
                        Mood Analytics
                    </h2>
                    <span class="text-xs font-medium px-3 py-1 bg-white/50 rounded-full text-slate-500">Last 7 Days</span>
                </div>
                <div class="h-64 w-full">
                    <canvas id="moodChart"></canvas>
                </div>
            </div>
        </section>

        <!-- Menu Grid -->
        <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-10 animate__animated animate__fadeInUp" style="animation-delay: 0.2s">
            
            <!-- Bad Mood Card -->
            <a href="badMood.html" class="group glass-card p-6 rounded-3xl hover:bg-white/80 transition-all hover:-translate-y-1 duration-300 shadow-sm border-l-4 border-l-rose-400">
                <div class="w-12 h-12 bg-rose-100 rounded-2xl flex items-center justify-center text-rose-500 mb-4 group-hover:scale-110 transition-transform">
                    <span class="iconify w-6 h-6" data-icon="lucide:frown"></span>
                </div>
                <h3 class="text-xl font-bold text-slate-800 mb-2">Bad Mood?</h3>
                <p class="text-sm text-slate-500">Support tools for difficult moments. Breathing, music, and chat.</p>
            </a>

            <!-- Pixel Thoughts Card -->
            <a href="pixelThoughts.html" class="group glass-card p-6 rounded-3xl hover:bg-white/80 transition-all hover:-translate-y-1 duration-300 shadow-sm border-l-4 border-l-indigo-400">
                <div class="w-12 h-12 bg-indigo-100 rounded-2xl flex items-center justify-center text-indigo-500 mb-4 group-hover:scale-110 transition-transform">
                    <span class="iconify w-6 h-6" data-icon="lucide:stars"></span>
                </div>
                <h3 class="text-xl font-bold text-slate-800 mb-2">Pixel Thoughts</h3>
                <p class="text-sm text-slate-500">Release your stress into the universe. Let it fade away.</p>
            </a>

            <!-- Drawing Card -->
            <a href="gambar.html" class="group glass-card p-6 rounded-3xl hover:bg-white/80 transition-all hover:-translate-y-1 duration-300 shadow-sm border-l-4 border-l-emerald-400">
                <div class="w-12 h-12 bg-emerald-100 rounded-2xl flex items-center justify-center text-emerald-500 mb-4 group-hover:scale-110 transition-transform">
                    <span class="iconify w-6 h-6" data-icon="lucide:palette"></span>
                </div>
                <h3 class="text-xl font-bold text-slate-800 mb-2">Art Therapy</h3>
                <p class="text-sm text-slate-500">Express yourself with Finger Drawing or Touch Canvas.</p>
            </a>
        </div>

    </main>

    <!-- Daily Check-in Modal -->
    <div id="checkInModal" class="fixed inset-0 modal-overlay z-50 hidden flex items-center justify-center p-4">
        <div class="glass-card w-full max-w-md rounded-3xl p-8 shadow-2xl animate__animated animate__zoomIn">
            <div class="text-center mb-6">
                <h2 class="text-2xl font-bold text-slate-800 mb-2">Daily Check-in</h2>
                <p class="text-slate-500">How are you feeling right now?</p>
            </div>

            <!-- Logo / Icon -->
            <div class="mb-8 flex justify-center">
                <div class="w-32 h-32 bg-gradient-to-tr from-violet-100 to-rose-100 rounded-full flex items-center justify-center shadow-inner border-4 border-white/50 relative group">
                    <div class="absolute inset-0 bg-white/30 rounded-full blur-xl group-hover:blur-2xl transition-all"></div>
                    <span class="iconify w-16 h-16 text-violet-500 relative z-10 drop-shadow-sm" data-icon="lucide:heart-handshake"></span>
                    
                    <!-- Floating particles decoration -->
                    <span class="iconify absolute top-6 right-6 w-4 h-4 text-rose-400 animate-bounce" style="animation-delay: 0.2s" data-icon="lucide:sparkles"></span>
                    <span class="iconify absolute bottom-6 left-6 w-4 h-4 text-indigo-400 animate-bounce" style="animation-delay: 0.5s" data-icon="lucide:star"></span>
                </div>
            </div>

            <!-- Inputs -->
            <div class="space-y-4">
                <div>
                    <label class="block text-xs font-semibold text-slate-500 uppercase tracking-wider mb-1">Current Mood</label>
                    <select id="moodSelect" class="w-full p-3 bg-white/60 border border-slate-200 rounded-xl text-slate-700 focus:outline-none focus:ring-2 focus:ring-violet-400">
                        <option value="5">üòÑ Amazing</option>
                        <option value="4">üôÇ Good</option>
                        <option value="3">üòê Okay</option>
                        <option value="2">üòï Not so good</option>
                        <option value="1">üò´ Terrible</option>
                    </select>
                </div>
                
                <div>
                    <label class="block text-xs font-semibold text-slate-500 uppercase tracking-wider mb-1">Mini Journal</label>
                    <textarea id="journalInput" rows="3" class="w-full p-3 bg-white/60 border border-slate-200 rounded-xl text-slate-700 placeholder:text-slate-400 focus:outline-none focus:ring-2 focus:ring-violet-400" placeholder="Why do you feel this way?"></textarea>
                </div>

                <button onclick="saveDailyCheckIn()" class="w-full py-3 bg-gradient-to-r from-violet-600 to-indigo-600 text-white font-bold rounded-xl shadow-lg shadow-violet-200 hover:shadow-xl transition-all active:scale-95">
                    Save & Continue
                </button>
            </div>
        </div>
    </div>

    <script>
        // --- Logic for Daily Check-in & Chart ---

        const today = new Date().toISOString().split('T')[0];
        const modal = document.getElementById('checkInModal');
        const greeting = document.getElementById('userGreeting');

        // 1. Check if already checked in
        function init() {
            const data = JSON.parse(localStorage.getItem('dutgen_logs') || '{}');
            
            if (!data[today]) {
                // Show modal if no data for today
                modal.classList.remove('hidden');
            } else {
                // Update greeting if data exists
                updateGreeting(data[today].moodValue);
            }
            
            renderChart(data);
            
            // Register Service Worker
            if ('serviceWorker' in navigator) {
                navigator.serviceWorker.register('sw.js')
                .then(reg => console.log('SW Registered'))
                .catch(err => console.log('SW Error', err));
            }
        }

        // 2. Save Check-in
        function saveDailyCheckIn() {
            const moodValue = document.getElementById('moodSelect').value;
            const journal = document.getElementById('journalInput').value;
            
            const data = JSON.parse(localStorage.getItem('dutgen_logs') || '{}');
            
            data[today] = {
                moodValue: parseInt(moodValue),
                journal: journal,
                timestamp: new Date().toISOString()
            };
            
            localStorage.setItem('dutgen_logs', JSON.stringify(data));
            
            // Close modal with animation
            const modalContent = modal.querySelector('div');
            modalContent.classList.remove('animate__zoomIn');
            modalContent.classList.add('animate__zoomOut');
            
            setTimeout(() => {
                modal.classList.add('hidden');
                modalContent.classList.remove('animate__zoomOut');
                modalContent.classList.add('animate__zoomIn'); // Reset for next time
                init(); // Re-render chart
            }, 300);
        }

        // 3. Reset (Dev tool)
        function resetDailyMood() {
            if(confirm('Reset today\'s mood log?')) {
                const data = JSON.parse(localStorage.getItem('dutgen_logs') || '{}');
                delete data[today];
                localStorage.setItem('dutgen_logs', JSON.stringify(data));
                location.reload();
            }
        }

        // 4. Helper: Update Greeting
        function updateGreeting(val) {
            const moods = {
                5: "Amazing",
                4: "Good",
                3: "Okay",
                2: "Strong",
                1: "Brave"
            };
            greeting.textContent = moods[val] || "Friend";
        }

        // 5. Render Chart
        function renderChart(data) {
            const ctx = document.getElementById('moodChart').getContext('2d');
            
            // Get last 7 days dates
            const labels = [];
            const values = [];
            
            for (let i = 6; i >= 0; i--) {
                const d = new Date();
                d.setDate(d.getDate() - i);
                const dateStr = d.toISOString().split('T')[0];
                const dayName = d.toLocaleDateString('en-US', { weekday: 'short' });
                
                labels.push(dayName);
                
                if (data[dateStr]) {
                    values.push(data[dateStr].moodValue);
                } else {
                    values.push(null); // Gap in chart
                }
            }

            new Chart(ctx, {
                type: 'line',
                data: {
                    labels: labels,
                    datasets: [{
                        label: 'Mood Level',
                        data: values,
                        borderColor: '#8b5cf6', // Violet-500
                        backgroundColor: 'rgba(139, 92, 246, 0.1)',
                        borderWidth: 3,
                        tension: 0.4, // Smooth curves
                        pointBackgroundColor: '#fff',
                        pointBorderColor: '#8b5cf6',
                        pointRadius: 5,
                        fill: true
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            beginAtZero: true,
                            max: 5,
                            ticks: {
                                stepSize: 1,
                                callback: function(value) {
                                    const map = {1: 'üò´', 2: 'üòï', 3: 'üòê', 4: 'üôÇ', 5: 'üòÑ'};
                                    return map[value];
                                },
                                font: { size: 20 }
                            },
                            grid: { borderDash: [5, 5] }
                        },
                        x: {
                            grid: { display: false }
                        }
                    },
                    plugins: {
                        legend: { display: false }
                    }
                }
            });
        }

        // Run init
        window.addEventListener('DOMContentLoaded', init);

    </script>
</body>
</html>